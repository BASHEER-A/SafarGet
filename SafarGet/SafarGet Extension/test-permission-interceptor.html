<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø¹ØªØ±Ø§Ø¶ Ù†Ø§ÙØ°Ø© Download Permission</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .test-button:active {
            transform: translateY(0);
        }
        
        .status {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
        }
        
        .info {
            background: rgba(0, 150, 255, 0.2);
            border: 1px solid rgba(0, 150, 255, 0.5);
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            background: rgba(255, 255, 255, 0.1);
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #00ff00;
        }
        
        .feature-list li:before {
            content: "âœ… ";
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø¹ØªØ±Ø§Ø¶ Ù†Ø§ÙØ°Ø© Download Permission</h1>
        
        <div class="test-section">
            <h2>ğŸ“‹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h2>
            <ul class="feature-list">
                <li>Ø§Ø¹ØªØ±Ø§Ø¶ Ù†Ø§ÙØ°Ø© "Download Permission" ÙÙŠ Safari</li>
                <li>ÙƒØ´Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ù…Ù† Ø®Ù„Ø§Ù„ beforeunload events</li>
                <li>Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù€ Permission API</li>
                <li>Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ù€ Navigation Ù„Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</li>
                <li>Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù€ MutationObserver Ù„Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©</li>
                <li>Ø§Ø¹ØªØ±Ø§Ø¶ XMLHttpRequest Ùˆ Fetch Ù„Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</li>
                <li>Ø§Ø¹ØªØ±Ø§Ø¶ download attribute</li>
                <li>Ø¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© (ProjectInfinity-X, GitHub, etc.)</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„</h2>
            
            <div class="status info">
                <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª:</strong> Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ®ØªØ¨Ø± Ù†Ø¸Ø§Ù… Ø§Ø¹ØªØ±Ø§Ø¶ Ù†Ø§ÙØ°Ø© Download Permission Ø§Ù„Ø¬Ø¯ÙŠØ¯
            </div>
            
            <button class="test-button" onclick="testDirectDownload()">
                ğŸ“¥ Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±
            </button>
            
            <button class="test-button" onclick="testDownloadAttribute()">
                ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± download attribute
            </button>
            
            <button class="test-button" onclick="testXHRDownload()">
                ğŸ“¡ Ø§Ø®ØªØ¨Ø§Ø± XHR download
            </button>
            
            <button class="test-button" onclick="testFetchDownload()">
                ğŸŒ Ø§Ø®ØªØ¨Ø§Ø± Fetch download
            </button>
            
            <button class="test-button" onclick="testBeforeUnload()">
                âš¡ Ø§Ø®ØªØ¨Ø§Ø± beforeunload
            </button>
            
            <button class="test-button" onclick="testPermissionAPI()">
                ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Permission API
            </button>
            
            <button class="test-button" onclick="testMutationObserver()">
                ğŸ‘ï¸ Ø§Ø®ØªØ¨Ø§Ø± MutationObserver
            </button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            <div id="status" class="status">
                <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h2>
            <div id="log" class="log">
                Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø«...
            </div>
        </div>
    </div>

    <script>
        // =================================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        // =================================================
        
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #00ff00;">[${timestamp}]</span> ${message}`;
            
            if (type === 'error') {
                logEntry.style.color = '#ff6b6b';
            } else if (type === 'success') {
                logEntry.style.color = '#00ff00';
            } else if (type === 'warning') {
                logEntry.style.color = '#ffa500';
            }
            
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            status.innerHTML = `<strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${message}`;
            status.className = `status ${type}`;
        }
        
        // =================================================
        // Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„
        // =================================================
        
        function testDirectDownload() {
            addLog('ğŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±...', 'info');
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„
            const link = document.createElement('a');
            link.href = 'https://example.com/test-file.zip';
            link.download = 'test-file.zip';
            link.textContent = 'ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù ØªØ¬Ø±ÙŠØ¨ÙŠ';
            
            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addLog('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡', 'success');
            updateStatus('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±', 'success');
        }
        
        function testDownloadAttribute() {
            addLog('ğŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± download attribute...', 'info');
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù…Ø¹ download attribute
            const link = document.createElement('a');
            link.href = 'https://httpbin.org/bytes/1024';
            link.download = 'test-download.bin';
            link.textContent = 'ØªØ­Ù…ÙŠÙ„ Ù…Ø¹ download attribute';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addLog('âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± download attribute', 'success');
            updateStatus('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± download attribute', 'success');
        }
        
        function testXHRDownload() {
            addLog('ğŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± XHR download...', 'info');
            
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://httpbin.org/bytes/512');
            xhr.onload = function() {
                addLog('âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ø³ØªØ¬Ø§Ø¨Ø© XHR', 'success');
                updateStatus('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± XHR download', 'success');
            };
            xhr.onerror = function() {
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ XHR download', 'error');
                updateStatus('ÙØ´Ù„ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± XHR download', 'error');
            };
            xhr.send();
        }
        
        function testFetchDownload() {
            addLog('ğŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Fetch download...', 'info');
            
            fetch('https://httpbin.org/bytes/256')
                .then(response => {
                    addLog('âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ø³ØªØ¬Ø§Ø¨Ø© Fetch', 'success');
                    updateStatus('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Fetch download', 'success');
                })
                .catch(error => {
                    addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Fetch download: ' + error.message, 'error');
                    updateStatus('ÙØ´Ù„ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Fetch download', 'error');
                });
        }
        
        function testBeforeUnload() {
            addLog('ğŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± beforeunload...', 'info');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø¯Ø« beforeunload
            const event = new Event('beforeunload');
            window.dispatchEvent(event);
            
            addLog('âœ… ØªÙ… Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« beforeunload', 'success');
            updateStatus('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± beforeunload', 'success');
        }
        
        function testPermissionAPI() {
            addLog('ğŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Permission API...', 'info');
            
            if ('permissions' in navigator) {
                navigator.permissions.query({ name: 'downloads' })
                    .then(result => {
                        addLog('âœ… ØªÙ… Ø§Ø³ØªØ¹Ù„Ø§Ù… Permission API: ' + result.state, 'success');
                        updateStatus('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Permission API', 'success');
                    })
                    .catch(error => {
                        addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Permission API: ' + error.message, 'error');
                        updateStatus('ÙØ´Ù„ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Permission API', 'error');
                    });
            } else {
                addLog('âš ï¸ Permission API ØºÙŠØ± Ù…ØªÙˆÙØ±', 'warning');
                updateStatus('Permission API ØºÙŠØ± Ù…ØªÙˆÙØ±', 'warning');
            }
        }
        
        function testMutationObserver() {
            addLog('ğŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± MutationObserver...', 'info');
            
            // Ø¥Ù†Ø´Ø§Ø¡ dialog ØªØ¬Ø±ÙŠØ¨ÙŠ
            const dialog = document.createElement('div');
            dialog.role = 'dialog';
            dialog.innerHTML = `
                <h3>Download Permission</h3>
                <p>Allow download from https://example.com/test.zip?</p>
                <button onclick="this.parentElement.remove()">Allow</button>
                <button onclick="this.parentElement.remove()">Deny</button>
            `;
            dialog.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                color: black;
                padding: 20px;
                border-radius: 10px;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            
            document.body.appendChild(dialog);
            
            addLog('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ dialog ØªØ¬Ø±ÙŠØ¨ÙŠ', 'success');
            updateStatus('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± MutationObserver', 'success');
            
            // Ø¥Ø²Ø§Ù„Ø© Dialog Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                if (dialog.parentElement) {
                    dialog.remove();
                    addLog('ğŸ—‘ï¸ ØªÙ… Ø¥Ø²Ø§Ù„Ø© dialog Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ', 'info');
                }
            }, 3000);
        }
        
        // =================================================
        // Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        // =================================================
        
        // Ù…Ø±Ø§Ù‚Ø¨ Ø±Ø³Ø§Ø¦Ù„ postMessage
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'DOWNLOAD_PERMISSION_DETECTED') {
                addLog('ğŸ¯ ØªÙ… Ø§Ø¹ØªØ±Ø§Ø¶ Ù†Ø§ÙØ°Ø© Download Permission!', 'success');
                addLog('ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + JSON.stringify(event.data.data, null, 2), 'info');
                updateStatus('ØªÙ… Ø§Ø¹ØªØ±Ø§Ø¶ Ù†Ø§ÙØ°Ø© Download Permission Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            }
        });
        
        // Ù…Ø±Ø§Ù‚Ø¨ console.log
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            
            const message = args.join(' ');
            if (message.includes('Download Permission') || 
                message.includes('download') || 
                message.includes('intercept')) {
                addLog('ğŸ” Console: ' + message, 'info');
            }
        };
        
        // =================================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        // =================================================
        
        window.addEventListener('load', function() {
            addLog('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'success');
            addLog('ğŸ“‹ Ø¬Ø§Ù‡Ø² Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ø¹ØªØ±Ø§Ø¶ Ù†Ø§ÙØ°Ø© Download Permission', 'info');
            updateStatus('Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'success');
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
        addLog('ğŸ”§ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…: 1.0.0', 'info');
        addLog('ğŸ¯ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: Download Permission Interceptor', 'info');
        addLog('ğŸŒ Ø§Ù„Ù…ØªØµÙØ­: ' + navigator.userAgent, 'info');
    </script>
</body>
</html>

